$(function(){"use strict";$.fn.AddScoreBar=function(e){return e?"string"==typeof e&&(e={language:e}):e={},e=$.extend({REFRESH_TIME:3e4,AJAX_URL:"ScoreBar.ashx",tpl:{ScoreBar:'<div class="worldcup-scorebar"><div class="image"></div><div class="arrow-left"><a href="#" class="disable"></a></div><div class="arrow-right"><a href="#" class="disable"></a></div><div class="matches"><ul class="slider" style="width:0px;"></ul></div></div>',Match:'<li><div class="home-team"><span class="flag"></span><span class="country">-</span><span class="score"></span></div><div class="away-team"><span class="flag"/></span><span class="country">-</span><span class="score"></span></div><div class="status"><span>-</span></div></li>'},tplName:"worldcup",language:"",league:""},e),this.each(function(){var a=$(e.tpl.ScoreBar).css("position","relative").appendTo(this),t=a.find(".matches"),n=a.find(".arrow-left"),i=a.find(".arrow-right"),s=$('<div class="endlight-left"></div>').hide().appendTo(t),l=$('<div class="endlight-right"></div>').hide().appendTo(t),o=$(s).add(l),d=$("<div class='scrollbar'></div>").hide().appendTo(t),c=a.find(".slider").hide(),r=0,u=t.innerWidth(),f=0,h=0,p=null,v=c.get(0).ownerDocument,m=$(e.tpl.Match).hide().appendTo(c).width()+1,g=Math.round(u/m),w=function(e,a){var t=function(e,a){var t,n=e.find(".score"),i=0;e.find(".flag").addClass(a.icon.toLowerCase()),e.find(".country").text(a.name),t=a.score||"-",""!==n.html()&&(i=3e3*Math.random()),n.html()!==t&&n.delay(i).animate({opacity:0,"font-size":"48px"},"fast",function(){$(this).html(t).animate({opacity:1,"font-size":"15px"},"slow")})};t(e.find(".home-team"),a.home),t(e.find(".away-team"),a.away),e.find(".status").text(a.status)},y=function(e,a,t){var s=a||0===a?a:1e3;e>h-g&&(e=h-g),0>e&&(e=0),p!==e&&(0!==h&&d.show().css("left",-c.position().left/f*u).animate({left:e/h*u},{duration:s,queue:!1}).delay(s).fadeOut("slow"),p=e,n.children("a").toggleClass("disable",0>=e),i.children("a").toggleClass("disable",e>=h-g),c.animate({left:-p*m},{duration:s,queue:!1},t))},T=function(a){var t={},n=function(t){var n,i,s=-1,l=new Date;if(t&&t.length&&0!==t.length){if(""===a){for(h=t.length,f=h*m,u>f&&(f=u),c.width(f),c.hide().empty().fadeIn({duration:2e3,queue:!1}),0!==h&&d.width(g/h*u),n=0;n<t.length;n++)t[n].mark&&-1===s&&(s=n);if(0>s)for(n=0;n<t.length;n++)try{t[n].GlobalShowTime&&new Date(t[n].GlobalShowTime)<l&&(s=n)}catch(o){}0>s&&(s=0),y(0===s?3:s>h-6?h-9:s-3,0),y(s,2e3)}for(n=0;n<t.length;n++)if(i=c.find(".match"+t[n].matchid),""===a)i=$(e.tpl.Match),i.addClass("match"+t[n].matchid),i.appendTo(c),w(i,t[n]);else{if(!i)return void T("");w(i,t[n])}}};a=0===h?"":a||"l",a&&$.extend(t,{q:a}),e.league&&$.extend(t,{league:e.league}),e.language&&$.extend(t,{lang:e.language}),$.post(e.AJAX_URL,t,n,"json"),r=(r+1)%20,0===r&&T("f")};i.click(function(e){e.preventDefault(),y(p+g)}),n.click(function(e){e.preventDefault(),y(p-g)}),setTimeout(function(){T("");var t=setInterval(T,e.REFRESH_TIME);a.data("timer",t)},0),function(){var e,a,t,n,i=!1,r=function(){if(i){if(null!==a){var h=c.position().left,p=0;h=t+a-e,h>0?(p=h/3,s.width(p>100?100:p).show(),h/=20):u>f+h?(p=(u-f-h)/3,l.width(p>100?100:p).show(),h=u-f+(f+h-u)/20):o.fadeOut("slow"),d.show().css("left",-h/f*u),c.css("left",h),a=null}n=setTimeout(r,1e3/60)}},h=function(e){return e.pageX||e.originalEvent.touches[0].pageX},g=function(s){i||s.which&&1!==s.which||(i=!0,a=e=h(s),t=c.position().left,n=setTimeout(r,1e3/60))},w=function(e){if(i&&(!e.which||1===e.which)){var a=Math.round(-c.position().left/m);p=-1,y(a,200),i=!1,o.fadeOut("slow"),d.fadeOut("slow")}},T=function(e){i&&(v.getSelection?v.getSelection().removeAllRanges():v.selection.empty(),e.preventDefault(),a=h(e))};c.mousedown(g).on("touchstart",g),$(v).on("mouseup touchend mouseleave",w).on("mousemove touchmove",T)}()}),this}});